# --- Memory and Swapping (Optimized for zRAM) ---

# High swappiness tells the kernel to prefer swapping out anonymous 
# pages to zRAM rather than evicting the file cache.
vm.swappiness = 180

# Recommended for zRAM to avoid unnecessary page lookahead latency.
vm.page-cluster = 0


# --- VFS and Cache (Btrfs metadata management) ---

# A value of 100 (default) ensures that Btrfs metadata (inodes/dentries) 
# are reclaimed fairly. This prevents the "memory hoarding" you saw 
# while keeping compilation fast enough.
vm.vfs_cache_pressure = 100

# Defines how much "free" memory the kernel keeps as a reserve.
# 50 is a sweet spot for 32GB RAM: high enough to handle sudden 
# spikes from DevContainers, but low enough to avoid large kernel overhead.
vm.watermark_scale_factor = 50
vm.watermark_boost_factor = 0


# --- Write-back (Prevents CoW/Btrfs stalls during compilation) ---

# Lower ratios force the kernel to write data to disk more frequently 
# in the background. This prevents the system from "freezing" when 
# the RAM fills with dirty pages during heavy compilation.
vm.dirty_ratio = 10
vm.dirty_background_ratio = 5


# --- Workload Specifics (VS Code & DevContainers) ---

# Required for VS Code, Docker/Podman, and some heavy memory-mapped 
# applications to prevent "out of memory" or "too many open files" errors.
vm.max_map_count = 1048576
